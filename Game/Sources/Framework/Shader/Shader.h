
#pragma once

#include "Pipeline/Pipeline.h"
#include "RootSignature/RootSignature.h"

struct RenderingSetting
{
	std::vector<InputLayout> InputLayouts;
	std::vector<DXGI_FORMAT> Formats;
	CullMode CullMode = CullMode::Back;
	BlendMode BlendMode = BlendMode::Alpha;
	PrimitiveTopologyType PrimitiveTopologyType = PrimitiveTopologyType::Triangle;
	bool IsDepth = true;
	bool IsDepthMask = true;
	int RTVCount = 1;
	bool IsWireFrame = false;
};

class Shader
{
public:
	// ボーン最大数
	static const int maxBoneBufferSize = 300;

	// シェーダー作成
	void Create(const std::wstring& filePath,
		const RenderingSetting& renderingSetting, const std::vector<RangeType>& rangeTypes);

	// 描画開始
	void Begin(int w, int h);

	// メッシュ描画
	void DrawMesh(const Mesh* mesh,const Math::Matrix& mWorld,const std::vector<Material>& materials);

	// モデル描画
	void DrawModel(const ModelData& modelData, const Math::Matrix& mWorld = Math::Matrix::Identity);
	void DrawModel(ModelWork& modelWork, const Math::Matrix& mWorld = Math::Matrix::Identity);

	// CBVカウント取得
	inline UINT GetCBVCount()const 
	{ return m_cbvCount; }

private:
	// シェーダーファイル読込
	void LoadShaderFile(const std::wstring& filePath);

	// マテリアルセット
	void SetMaterial(const Material& material) const;

	std::unique_ptr<Pipeline>		m_upPipeline = nullptr;
	std::unique_ptr<RootSignature>	m_upRootSignature = nullptr;

	ComPtr<ID3DBlob> m_pVSBlob = nullptr;	// 頂点シェーダー
	ComPtr<ID3DBlob> m_pHSBlob = nullptr;	// ハルシェーダー
	ComPtr<ID3DBlob> m_pDSBlob = nullptr;	// ドメインシェーダー
	ComPtr<ID3DBlob> m_pGSBlob = nullptr;	// ジオメトリシェーダー
	ComPtr<ID3DBlob> m_pPSBlob = nullptr;	// ピクセルシェーダー

	UINT m_cbvCount = 0;
};
